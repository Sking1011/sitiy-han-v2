# Список задач (TODO) — Проект "Сити Хан"

> **Важно:** Перед выполнением задачи обязательно изучи указанный файл документации (`[Ref: ...]`).

## Этап 1: Инициализация и Инфраструктура
*Документация: `docs/03_tech_stack.md`, `docs/06_file_structure.md`*
- [ ] Инициализировать Next.js проект (TypeScript, Tailwind, App Router).
- [ ] Настроить Prisma ORM и подключить PostgreSQL (через Docker).
- [ ] **Создать Seed Script (`prisma/seed.ts`) для создания Админа и базовых Категорий.**
- [ ] Создать базовую дизайн-систему (Shadcn UI, шрифты, темы).
- [ ] Реализовать переключение Темной/Светлой темы.
- [ ] Настроить NextAuth.js (Авторизация по логину/паролю).

## Этап 1.5: Безопасность и Роли (RBAC)
*Документация: `docs/07_roles_and_security.md`, `docs/04_db_schema.md`*
- [ ] Обновить БД: Добавить роли `ADMIN`, `DIRECTOR`, `OPERATOR`, `ACCOUNTANT`.
- [ ] Middleware: Создать защиту маршрутов (`withRole`).
- [ ] **Redirect Logic:** Оператор при входе летит на `/production`, остальные на `/`.
- [ ] Компонент `<RoleGuard>`: Условно скрывать части UI (деньги, кнопки).
- [ ] Сервис Логирования (`AuditService`): Запись всех действий.
- [ ] Страница "Журнал действий" (только для Админов).

## Этап 2: Навигация и Общая Структура
*Документация: `docs/05_ui_ux_guide.md`, `docs/06_file_structure.md`*
- [ ] Создать Desktop Sidebar (боковое меню).
- [ ] Создать Mobile Bottom Tab Bar с кнопкой FAB.
- [ ] Реализовать меню быстрых действий (Quick Actions Sheet).
- [ ] Настроить защищенные роуты (Middleware).
- [ ] **Реализовать утилиту `formatUnit` (умное форматирование кг/г, л/мл).**
- [ ] **Создать компонент `UnitInput` (поле ввода с селектором единиц).**

## Этап 3: Модуль "Склад" (Inventory)
*Документация: `docs/01_business_logic.md`, `docs/04_db_schema.md`*
- [ ] **Гибкое управление Категориями:** CRUD (Создать/Редактировать/Удалить).
- [ ] Поддержка вложенности: Категория -> Подкатегория (Meat -> Beef).
- [ ] **Добавить выбор Цвета/Иконки для категории.**
- [ ] Реализовать адаптивное отображение: **Таблица (Desktop) / Карточки (Mobile)**.
- [ ] Добавить индикацию критических остатков (цветовая схема).
- [ ] Форма добавления/редактирования позиций склада.

## Этап 4: Закупки и Расходы (Procurement)
*Документация: `docs/01_business_logic.md`, `docs/04_db_schema.md`*
- [ ] Создать форму оформления закупа.
- [ ] Поле "Источник оплаты" (Бизнес/Личные).
- [ ] Логика автоматического пополнения склада.

## Этап 5: Калькуляция и Производство
*Документация: `docs/01_business_logic.md` (раздел Производство)*
- [ ] Конструктор рецептов (Техкарты).
- [ ] Интерфейс "Создать партию" (выбор рецепта).
- [ ] **Строгое списание:** Блокировка редактирования ингредиентов для Оператора.
- [ ] Логика транзакции (Списание по норме -> Начисление продукции).

## Этап 5.2: Контроль и Инвентаризация
*Документация: `docs/07_roles_and_security.md`*
- [ ] Интерфейс "Ревизия" для Директора.
- [ ] Сверка: Системный остаток vs Фактический ввод.
- [ ] Акт списания (брак).

## Этап 6: Продажи (Sales)
*Документация: `docs/01_business_logic.md`*
- [ ] Интерфейс оформления продажи.
- [ ] Автоматическое списание готовой продукции со склада.

## Этап 7: Дашборд и Аналитика
*Документация: `docs/05_ui_ux_guide.md`*
- [ ] **Виджет "Свободные деньги" (Free Cash).**
- [ ] Финансовый блок: Переключатель "До налогов" / "После налогов".
- [ ] Настройки налогов: Глобальная переменная `TAX_RATE`.

## Этап 7.5: Бухгалтерия и Экспорт
*Документация: `docs/05_ui_ux_guide.md`, `docs/07_roles_and_security.md`*
- [ ] **Экспорт данных:** Библиотека `xlsx`.
- [ ] Страница "Финансы": Таблица P&L.
- [ ] Доступ только для `DIRECTOR`, `ADMIN`, `ACCOUNTANT`.

## Этап 9: Будущее (v2.0 - Telegram Bot)
*Документация: `docs/03_tech_stack.md` (Service Layer)*
- [ ] Реализовать Event Emitter в сервисах.
- [ ] Написать Telegram Bot.
