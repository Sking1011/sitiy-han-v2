# Список задач (TODO) — Проект "Сытый Хан"

> **Важно:** Перед выполнением задачи обязательно изучи указанный файл документации (`[Ref: ...]`).
> **Оценка времени:** (h) — часы.

## Этап 1: Инициализация и Инфраструктура (8h)
- [x] Инициализировать Next.js проект (TypeScript, Tailwind, App Router). `(2h)`
- [x] Настроить Prisma ORM и подключить PostgreSQL (через Docker). `(2h)`
- [x] **Создать Seed Script (`prisma/seed.ts`) для создания Админа и базовых Категорий.** `(1h)`
- [x] Создать базовую дизайн-систему (Shadcn UI, шрифты, темы). `(1h)`
- [x] Реализовать переключение Темной/Светлой темы. `(1h)`
- [x] Настроить NextAuth.js (Авторизация по логину/паролю). `(1h)`

## Этап 1.5: Безопасность и Роли (RBAC) (6h)
- [x] Обновить БД: Добавить роли `ADMIN`, `DIRECTOR`, `OPERATOR`, `ACCOUNTANT`. `(1h)`
- [x] Middleware: Создать защиту маршрутов (`withRole`). `(1h)`
- [x] **Redirect Logic:** Оператор при входе летит на `/production`, остальные на `/`. `(1h)`
- [x] Компонент `<RoleGuard>`: Условно скрывать части UI (деньги, кнопки). `(1h)`
- [x] Сервис Логирования (`AuditService`): Запись всех действий. `(1h)`
- [x] Страница "Журнал действий" (только для Админов). `(1h)`

## Этап 2: Навигация и Общая Структура (8h)
- [x] Создать Desktop Sidebar (боковое меню). `(2h)`
- [x] Создать Mobile Bottom Tab Bar с кнопкой FAB. `(2h)`
- [x] Реализовать меню быстрых действий (Quick Actions Sheet). `(1h)`
- [x] Настроить защищенные роуты (Middleware). `(0.5h)`
- [x] **Реализовать утилиту `formatUnit` (умное форматирование кг/г, л/мл).** `(0.5h)`
- [x] **Создать компонент `UnitInput` (поле ввода с селектором единиц).** `(1h)`
- [x] Личный профиль и выход. `(1h)`

## Этап 3: Модуль "Склад" (Inventory) (12h)
- [x] **Гибкое управление Категориями:** CRUD (Создать/Редактировать/Удалить). `(2h)`
- [ ] Поддержка вложенности: Категория -> Подкатегория (Meat -> Beef). `(2h)`
- [x] **Добавить выбор Цвета/Иконки для категории.** `(1h)`
- [x] Реализовать адаптивное отображение: **Плитки (Grid) с Progress Bar**. `(3h)`
- [x] Добавить индикацию критических остатков (цветовая схема). `(1h)`
- [x] Форма добавления/редактирования/удаления позиций склада в диалогах. `(3h)`

## Этап 4: Закупки и Расходы (Procurement) (10h)
- [x] Быстрый закуп из FAB/Header. `(2h)`
- [ ] Расширенная форма оформления закупа (мульти-позиции). `(3h)`
- [x] Поле "Источник оплаты" (Бизнес/Личные). `(1h)`
- [x] Логика автоматического пополнения склада и расчет средней цены. `(2h)`
- [ ] История закупок с фильтрами. `(2h)`

## Этап 5: Калькуляция и Производство (16h)
- [ ] Конструктор рецептов (Техкарты). `(5h)`
- [x] Интерфейс "Создать партию" (выбор рецепта). `(3h)`
- [x] **Строгое списание:** Блокировка редактирования ингредиентов для Оператора. `(2h)`
- [x] Логика транзакции (Списание по норме -> Начисление продукции). `(4h)`
- [x] Журнал производства. `(2h)`

## Этап 5.2: Контроль и Инвентаризация (8h)
- [ ] Интерфейс "Ревизия" для Директора. `(3h)`
- [ ] Сверка: Системный остаток vs Фактический ввод. `(3h)`
- [ ] Акт списания (брак). `(2h)`

## Этап 6: Продажи (Sales) (10h)
- [x] Интерфейс быстрой продажи (одиночный товар). `(2h)`
- [ ] Корзина продаж (несколько товаров в один чек). `(3h)`
- [x] Автоматическое списание готовой продукции со склада с контролем остатка. `(2h)`
- [ ] История продаж и печать чека (простая версия). `(3h)`

## Этап 7: Дашборд и Аналитика (12h)
- [x] **Виджет "Свободные деньги" (Free Cash) с живым расчетом.** `(2h)`
- [ ] Финансовый блок: Переключатель "До налогов" / "После налогов". `(2h)`
- [ ] Графики Recharts (Прибыль, Выручка, ТОП товаров). `(5h)`
- [ ] Настройки налогов: Глобальная переменная `TAX_RATE`. `(1h)`
- [ ] Уведомления о критических остатках на главной. `(2h)`

## Этап 7.5: Бухгалтерия и Экспорт (10h)
- [ ] **Экспорт данных:** Библиотека `xlsx` (Excel). `(4h)`
- [ ] Страница "Финансы": Таблица P&L (Profit and Loss). `(4h)`
- [ ] Доступ только для `DIRECTOR`, `ADMIN`, `ACCOUNTANT`. `(2h)`

## Этап 9: Будущее (v2.0 - Telegram Bot) (20h+)
- [ ] Реализовать Event Emitter в сервисах. `(4h)`
- [ ] Написать Telegram Bot (aiogram/telegraf). `(16h+)`